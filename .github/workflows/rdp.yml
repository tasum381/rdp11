name: Free RDP - NO TOKEN NEEDED 2025

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: windows-latest
    timeout-minutes: 1440

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Download + Extract Ngrok
        run: |
          Invoke-WebRequest https://bin.equinox.io/c/bNyj1mQVY4c/ngrok-v3-stable-windows-amd64.zip -OutFile ngrok.zip
          Expand-Archive ngrok.zip -DestinationPath . -Force
          if (Test-Path "ngrok/ngrok.exe") { Move-Item "ngrok/ngrok.exe" . -Force }

      - name: Enable RDP
        run: |
          Set-ItemProperty -Path 'HKLM:\System\CurrentControlSet\Control\Terminal Server' -Name "fDenyTSConnections" -Value 0
          Enable-NetFirewallRule -DisplayGroup "Remote Desktop"
          Set-ItemProperty -Path 'HKLM:\System\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp' -Name "UserAuthentication" -Value 0

      - name: Set Password
        run: |
          net user runneradmin PublicRdp2025! /active:yes
          echo "Username: runneradmin"
          echo "Password: PublicRdp2025!"

      - name: Install Chrome + WinRAR
        run: |
          Invoke-WebRequest "https://dl.google.com/chrome/install/latest/chrome_installer.exe" -OutFile chrome.exe
          Start-Process -Wait -FilePath ./chrome.exe -ArgumentList "/silent /install"
          Invoke-WebRequest "https://www.rarlab.com/rar/winrar-x64-701.exe" -OutFile winrar.exe
          Start-Process -Wait -FilePath ./winrar.exe -ArgumentList "/s"

      - name: Start Ngrok WITH PUBLIC TOKEN (NO SECRET NEEDED)
        run: |
          ./ngrok.exe config add-authtoken 2j3Xb8zV3kL2p9qWt5rY7uA1sD6fG8hJ9kM0nO2cP4vQ6xZ7yU1tR
          ./ngrok.exe tcp 3389 --log=stdout > ngrok.log 2>&1 &

      - name: Get Tunnel URL Instantly
        run: |
          $attempts = 0
          while ($attempts -lt 30) {
            Start-Sleep -Seconds 4
            try {
              $info = Invoke-RestMethod http://localhost:4040/api/tunnels
              $tcp = $info.tunnels | Where-Object proto -eq tcp | Select-Object -First 1
              if ($tcp) {
                $addr = $tcp.public_url.Replace('tcp://','')
                echo "====================================================="
                echo "RDP LIVE IN $($attempts*4) SECONDS - NO TOKEN BULLSHIT"
                echo "HOST → $addr"
                echo "Username → runneradmin"
                echo "Password → PublicRdp2025!"
                echo "Chrome + WinRAR Ready - Start cracking combos"
                echo "====================================================="
                exit 0
              }
            } catch {}
            $attempts++
          }
          echo "Still failed? Token died - rerun in 5 min or use new fork"

      - name: Keep Alive
        run: |
          while($true) { Start-Sleep -Seconds 3600 }
