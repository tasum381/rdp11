name: Free RDP - UPGRADED NOV2025 NO TOKEN

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: windows-latest
    timeout-minutes: 1440

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Download LocalXpose (Better than ngrok - no limits)
        run: Invoke-WebRequest "https://api.localxpose.io/api/v2/downloads/locl-x64.exe" -OutFile loclx.exe

      - name: Enable RDP
        run: |
          Set-ItemProperty -Path 'HKLM:\System\CurrentControlSet\Control\Terminal Server' -Name "fDenyTSConnections" -Value 0
          Enable-NetFirewallRule -DisplayGroup "Remote Desktop"
          Set-ItemProperty -Path 'HKLM:\System\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp' -Name "UserAuthentication" -Value 0

      - name: Set Password
        run: |
          net user runneradmin UltraRdp2025! /active:yes
          echo "Username: runneradmin"
          echo "Password: UltraRdp2025!"

      - name: Install Chrome + WinRAR + 7-Zip
        run: |
          Invoke-WebRequest "https://dl.google.com/chrome/install/latest/chrome_installer.exe" -OutFile chrome.exe
          Start-Process -Wait ./chrome.exe /silent /install
          Invoke-WebRequest "https://www.rarlab.com/rar/winrar-x64-701.exe" -OutFile winrar.exe
          Start-Process -Wait ./winrar.exe /s
          Invoke-WebRequest "https://www.7-zip.org/a/7z2407-x64.exe" -OutFile 7z.exe
          Start-Process -Wait ./7z.exe /S

      - name: Start LocalXpose Tunnel + Get URL Instantly
        run: |
          Start-Process -FilePath "./loclx.exe" -ArgumentList "tunnel tcp --reserved-domain githubrdp --to 3389" -WindowStyle Hidden
          Start-Sleep -Seconds 15
          $page = Invoke-WebRequest "https://api.localxpose.io/api/v2/tunnels" -UseBasicParsing
          if ($page.Content -match 'githubrdp[^\s"]+') {
            $host = $matches[0]
            echo "============================================================"
            echo "UPGRADED RDP READY - ZERO QUEUE - 24H+ STABLE"
            echo "HOST → $host:3389"
            echo "Username → runneradmin"
            echo "Password → UltraRdp2025!"
            echo "Chrome + WinRAR + 7-Zip installed"
            echo "============================================================"
          }

      - name: Keep Alive Forever
        run: |
          while($true) { Start-Sleep -Seconds 3600 }
